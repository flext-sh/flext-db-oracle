"""Oracle Database exceptions using FLEXT ecosystem patterns.

All Oracle-specific exceptions are automatically generated by flext-core.

Copyright (c) 2025 FLEXT Team. All rights reserved.
SPDX-License-Identifier: MIT
"""

from __future__ import annotations

from dataclasses import dataclass

from flext_core import FlextExceptions, FlextTypes


class FlextDbOracleExceptions:
    """Unified Oracle Database Exception System using flext-core exclusively."""

    @dataclass(frozen=True)
    class ExceptionParams:
        """Exception parameters for Oracle database exceptions."""

        message: str
        code: str | None = None
        context: FlextTypes.Core.Dict | None = None

        def __post_init__(self) -> None:
            """Validate exception parameters."""
            if not self.message or not self.message.strip():
                msg = "Exception message cannot be empty"
                raise ValueError(msg)

    class OracleErrorCodes:
        """Oracle-specific error codes."""

        VALIDATION_ERROR = "ORACLE_VALIDATION_ERROR"
        CONFIGURATION_ERROR = "ORACLE_CONFIGURATION_ERROR"
        CONNECTION_ERROR = "ORACLE_CONNECTION_ERROR"
        AUTHENTICATION_ERROR = "ORACLE_AUTHENTICATION_ERROR"
        PROCESSING_ERROR = "ORACLE_PROCESSING_ERROR"
        TIMEOUT_ERROR = "ORACLE_TIMEOUT_ERROR"
        QUERY_ERROR = "ORACLE_QUERY_ERROR"
        METADATA_ERROR = "ORACLE_METADATA_ERROR"

    # Base error class for Oracle exceptions
    class BaseError(Exception):
        """Base error class for Oracle exceptions."""

        def __init__(
            self,
            message: str,
            code: str | None = None,
            context: FlextTypes.Core.Dict | None = None,
        ) -> None:
            """Initialize Oracle exception with message, code, and context."""
            super().__init__(message)
            self.error_code: str | None = code
            self.context: FlextTypes.Core.Dict = context or {}

    # Oracle exception classes
    class Error(BaseError):
        """General Oracle error."""

        def __init__(
            self,
            message: str,
            code: str | None = None,
            context: FlextTypes.Core.Dict | None = None,
        ) -> None:
            """Initialize Oracle error."""
            super().__init__(message, code, context)

    class ValidationError(BaseError):
        """Oracle validation error."""

        def __init__(
            self,
            message: str,
            code: str | None = None,
            context: FlextTypes.Core.Dict | None = None,
        ) -> None:
            """Initialize validation error with flext-core defaults."""
            # Use flext-core default behavior for ValidationError (code parameter ignored)
            _ = code  # Ignored - flext-core uses fixed code
            actual_code = "VALIDATION_ERROR"
            actual_context: FlextTypes.Core.Dict = {
                "field": None,
                "value": None,
                "validation_details": None,
            }
            if context:
                # Add custom fields but preserve default field values
                default_fields = {"field", "value", "validation_details"}
                for key, value in context.items():
                    if key not in default_fields:
                        actual_context[key] = value
                    # Default fields keep their default values (None)
            super().__init__(message, actual_code, actual_context)

    class ConfigurationError(BaseError):
        """Oracle configuration error."""

        def __init__(
            self,
            message: str,
            code: str | None = None,
            context: FlextTypes.Core.Dict | None = None,
        ) -> None:
            """Initialize configuration error with flext-core defaults."""
            # Use flext-core default behavior for ConfigurationError (code parameter ignored)
            _ = code  # Ignored - flext-core uses fixed code
            actual_code = "CONFIGURATION_ERROR"
            actual_context: FlextTypes.Core.Dict = {
                "config_key": None,
                "config_file": None,
            }
            if context:
                actual_context.update(context)
            super().__init__(message, actual_code, actual_context)

    class OracleConnectionError(BaseError):
        """Oracle connection error (renamed to avoid builtin shadowing)."""

        def __init__(
            self,
            message: str,
            code: str | None = None,
            context: FlextTypes.Core.Dict | None = None,
        ) -> None:
            """Initialize connection error with flext-core defaults."""
            # Use flext-core default behavior for ConnectionError (code parameter ignored)
            _ = code  # Ignored - flext-core uses fixed code
            actual_code = "CONNECTION_ERROR"
            actual_context: FlextTypes.Core.Dict = {
                "endpoint": None,
                "service": None,
            }
            if context:
                actual_context.update(context)
            super().__init__(message, actual_code, actual_context)

    class AuthenticationError(BaseError):
        """Oracle authentication error."""

        def __init__(
            self,
            message: str,
            code: str | None = None,
            context: FlextTypes.Core.Dict | None = None,
        ) -> None:
            """Initialize authentication error with flext-core defaults."""
            # Use flext-core default behavior for AuthenticationError (code parameter ignored)
            _ = code  # Ignored - flext-core uses fixed code
            actual_code = "AUTHENTICATION_ERROR"
            actual_context: FlextTypes.Core.Dict = {
                "auth_method": None,
                "user": None,
            }
            if context:
                actual_context.update(context)
            super().__init__(message, actual_code, actual_context)

    class ProcessingError(BaseError):
        """Oracle processing error."""

        def __init__(
            self,
            message: str,
            code: str | None = None,
            context: FlextTypes.Core.Dict | None = None,
        ) -> None:
            """Initialize processing error."""
            # Use custom code only if it's not an Oracle constant
            error_codes = FlextDbOracleExceptions.OracleErrorCodes
            if code and code not in error_codes.__dict__.values():
                actual_code = code
            else:
                actual_code = "PROCESSING_ERROR"
            actual_context: FlextTypes.Core.Dict = {
                "business_rule": None,
                "stage": None,
            }
            if context:
                actual_context.update(context)
            super().__init__(message, actual_code, actual_context)

    class OracleTimeoutError(BaseError):
        """Oracle timeout error (renamed to avoid builtin shadowing)."""

        def __init__(
            self,
            message: str,
            code: str | None = None,
            context: FlextTypes.Core.Dict | None = None,
        ) -> None:
            """Initialize timeout error."""
            # Use custom code only if it's not an Oracle constant
            error_codes = FlextDbOracleExceptions.OracleErrorCodes
            if code and code not in error_codes.__dict__.values():
                actual_code = code
            else:
                actual_code = "TIMEOUT_ERROR"
            actual_context: FlextTypes.Core.Dict = {
                "timeout_seconds": None,
                "operation": None,
            }
            if context:
                actual_context.update(context)
            super().__init__(message, actual_code, actual_context)

    class QueryError(ProcessingError):
        """Oracle query error."""

        def __init__(
            self,
            message: str,
            code: str | None = None,
            context: FlextTypes.Core.Dict | None = None,
        ) -> None:
            """Initialize query error."""
            actual_code = code or "PROCESSING_ERROR"
            super().__init__(message, actual_code, context)

    class MetadataError(ProcessingError):
        """Oracle metadata error."""

        def __init__(
            self,
            message: str,
            code: str | None = None,
            context: FlextTypes.Core.Dict | None = None,
        ) -> None:
            """Initialize metadata error."""
            # MetadataError is alias for ProcessingError (code parameter ignored)
            _ = code  # Ignored - MetadataError uses fixed PROCESSING_ERROR code
            super().__init__(message, "PROCESSING_ERROR", context)

    @classmethod
    def create_validation_error(
        cls,
        message: str,
        context: FlextTypes.Core.Dict | None = None,
    ) -> "FlextDbOracleExceptions.ValidationError":
        """Factory method for validation errors using flext-core."""
        return cls.ValidationError(message, context=context)

    @classmethod
    def create_connection_error(
        cls,
        message: str,
        context: FlextTypes.Core.Dict | None = None,
    ) -> "FlextDbOracleExceptions.OracleConnectionError":
        """Factory method for connection errors using flext-core."""
        return cls.OracleConnectionError(message, context=context)

    @classmethod
    def is_oracle_error(cls, error: Exception) -> bool:
        """Check if exception is an Oracle database error using flext-core."""
        return isinstance(error, cls.BaseError)


__all__: FlextTypes.Core.StringList = [
    "FlextDbOracleExceptions",
]
